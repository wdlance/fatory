<template>
<div class="page-container">
<div class="search-wrapper">
 <div class="block">
    <span class="label">开始时间</span>
    <el-date-picker
      v-model="searchForm.startTime"
      type="date"
	:clearable="true"
	  format="yyyy-MM-dd 00:00:00"
      placeholder="选择日期">
    </el-date-picker>
  </div>
   <div class="block">
    <span class="label">结束时间</span>
    <el-date-picker
		:clearable="true"
      v-model="searchForm.endTime"
      type="date"
	  format="yyyy-MM-dd 23:59:59"
      placeholder="选择日期">
    </el-date-picker>
  </div>
<div class="block">
<div class="label">账号</div>
 <el-input v-model="searchForm.account"></el-input>
</div>
<div class="block">
<div class="label">内容</div>
 <el-input v-model="searchForm.content"></el-input>
</div>
  <div class="operates">
   <el-button type="primary" @click="searchClick">查询</el-button>
    <el-button type="primary" @click="resetClick">重置</el-button>
  </div>
</div>
<el-table
      :data="tableData"
      style="width: 100%">
      <el-table-column
        prop="CreateTime"
        label="日期"
        width="180">
      </el-table-column>
      <el-table-column
        prop="UserName"
        label="账号"
        width="180">
      </el-table-column>
       <el-table-column
        prop="RoleName"
        label="角色"
        width="180">
      </el-table-column>
      <el-table-column
        prop="Content"
        label="内容">
      </el-table-column>
    </el-table>
    <el-pagination
    
      @current-change="handleCurrentChange"
      :current-page.sync="pageData.Page"
      :page-size="pageData.RowNum"
      layout="total, prev, pager, next"
      :total="RowNum">
      </el-pagination>
</div>
</template>
<script>
import {LOG_API_PATH} from "../../service/api"
import {RoleList} from "../../service/constant"
export default{
    data(){
        return {
            tableData:[],
            searchForm:{
                     startTime:new Date(new Date().toLocaleDateString()),
                     endTime:new Date(new Date().toLocaleDateString()),
                account:"",
                content:""
            },
            RowNum:0,
            pageData:{
             Page:1,
             RowNum:20
            }
        }
    },
    created(){
      this.getLogList()
    },
    methods:{
      getLogList(){
        let formData = new FormData()
        formData.append("Token",sessionStorage.getItem("token"))
        formData.append("Act","GetLogList")
        formData.append("Page",this.pageData.Page-1)
        formData.append("RowNum",this.pageData.RowNum)
       let startTime = this.moment(this.searchForm.startTime).format("YYYY-MM-DD 00:00:00")
        let endTime = this.moment(this.searchForm.endTime).format("YYYY-MM-DD 23:59:59")
        formData.append("StartTime",new Date(startTime).getTime()/1000)
        formData.append("EndTime",new Date(endTime).getTime()/1000)
        formData.append("UserName",this.searchForm.account)
        formData.append("Content",this.searchForm.content)
        this.$axios.post(LOG_API_PATH,formData).then(res=>{
          if(res.data.Ret == 0){
						res.data.Data = res.data.Data?res.data.Data:[]
            res.data.Data.map(v=>{
              v.CreateTime = this.moment(v.CreateTime*1000).format("YYYY-MM-DD HH:mm:ss")
              v.RoleName = RoleList.find(role=>role.id == v.RoleID)?RoleList.find(role=>role.id == v.RoleID).name:""
            })
            this.tableData = res.data.Data
            this.RowNum = res.data.Recordcount
          }else{
         
						this.$message({
							message:res.data.Msg,
							type:"error",
							duration:3000
						});
          }
        })
      },
      handleCurrentChange(){
        this.getLogList()
      },
      searchClick(){
        this.getLogList()
      },
      resetClick(){
        this.searchForm = {
           startTime:new Date().toLocaleDateString(),
                endTime:new Date().toLocaleDateString(),
                account:"",
                content:""
        }
      }
    }
}
</script>
<style scoped="scoped">
.search-wrapper{
    display:flex;
    flex-wrap:wrap;
		justy-content:flex-start;
}

</style>